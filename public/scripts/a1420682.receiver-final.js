!function(a){"use strict";var b={};a.require=function(a){return b[a]},a.define=function(a,c){b[a]=c}}(window),define("console",function(a){"use strict";if(a.JSInterface&&a.JSInterface.log){var b=function(){return function(){a.JSInterface.log.apply(a.JSInterface,arguments)}};return{log:b("log"),info:b("info"),warn:b("warn"),error:b("error"),debug:b("debug")}}return console.log(a.console),a.console}(window)),define("supervisor",function(a){"use strict";function b(){var b=a.location.hash.slice(1).split(/[,#]/).map(function(a){var b=/^timeout=(\d+)$/.exec(a);return b?parseInt(b[1]):null}).filter(function(a){return null!==a});return 0===b.length?void 0:b[0]}var c=null,d=function(){console.debug("[Dashkiosk] Send heartbeat to supervisor"),a.parent&&a.parent.postMessage&&a.parent.postMessage("ready","*"),a.JSInterface&&a.JSInterface.ready&&a.JSInterface.ready();var e;a.JSInterface&&a.JSInterface.timeout&&(e=a.JSInterface.timeout()),e=e||b(),c&&a.clearTimeout(c),e&&(c=a.setTimeout(d,.8*e))};return{ready:d}}(window)),define("errors",function(a){"use strict";return{enable:function(){a.onerror=function(b,c,d,e,f){try{return void 0===f||null===f?!1:(console.error("[Dashkiosk] ("+c+":"+d+":"+e+"): "+b),console.error("[Dashkiosk] Stack:\n"+f.stack),!0)}finally{console.error("[Dashkiosk] Fatal unexpected error, let's reload"),setTimeout(function(){a.location.reload()},1e3)}}}}}(window)),define("viewport",function(a,b){"use strict";function c(a){if(!a)return void(this.width=this.height=null);var b=a.split("x");this.width=b[0]||null,this.height=b[1]||null}return c.prototype.update=function(){if(this.width||this.height){var a=[this.width?"width="+this.width:"",this.height?"height="+this.height:"","user-scalable=no"];b('meta[name="viewport"]').attr("content",a.join(","))}else b('meta[name="viewport"]').attr("content","width=device-width,user-scalable=no")},c.prototype.adapt=function(b){if(this.width||this.height){var c=a.document.documentElement.clientWidth,d=a.document.documentElement.clientHeight,e=this.width||this.height*c/d,f=this.height||this.width*d/c,g=Math.min(c/e,d/f);if(.02>g-1&&g-1>-.02)return void console.info("[Dashkiosk] No need to rescale, viewport is already OK");console.info("[Dashkiosk] Will apply a scale factor of "+g),e=Math.round(e),f=Math.round(f),g="scale("+g+")",b.css({width:e+"px",height:f+"px","-moz-transform":g,"-webkit-transform":g,transform:g})}},c}(window,Zepto)),define("iframe-queue",function(a,b,c){"use strict";function d(a,c){var d=this,e=new f(a.viewport);this.dashboard=a,this.ready=c.ready,this.el=b("<iframe>").appendTo("body").one("load",function(){d.show()}).attr("scrolling","no").attr("frameborder","0"),e.adapt(this.el),this.el.attr("src",a.url)}function e(a){this.queue=[],this.ready=a.ready}var f=require("viewport");return d.prototype.displayed=function(){return this.el.hasClass("show")},d.prototype.remove=function(){var b=this;this.el.hasClass("show")?(this.el.removeClass("show"),a.setTimeout(function(){b.el.remove()},1001)):this.el.remove()},d.prototype.show=function(){console.info("[Dashkiosk] iframe ready "+this.el.attr("src")),this.ready&&this.ready(),this.el.addClass("show")},e.prototype.flush=function(){for(var a;a=this.queue.shift();)a.remove()},e.prototype.push=function(a){var b=this,e=this.queue.shift();e!==c&&(e.displayed()?this.queue.unshift(e):e.remove()),e=new d(a,{ready:function(){if(e!==b.queue[0])return console.warn("[Dashkiosk] BUG: request to display a new iframe which is not in our queue",e,b.queue),void e.remove();for(;b.queue.length>1;){var a=b.queue.pop();a.remove()}b.ready()}}),this.queue.unshift(e)},e}(window,Zepto)),define("screen",function(a){"use strict";function b(){e.flush(),a("#loading").addClass("show")}function c(a){return"string"!=typeof a.url?void console.warn("[Dashkiosk] received an URL without target: "+a.url):void e.push(a)}var d=require("iframe-queue"),e=new d({ready:function(){a("#loading").removeClass("show")}});return{loading:b,dashboard:c}}(Zepto)),define("localstorage",function(a,b){"use strict";function c(){}function d(a){this.name=a}function e(){}"localStorage"in a&&null!==a.localStorage?(c.prototype.getItem=function(b){return a.localStorage.getItem(b)},c.prototype.setItem=function(b,c){a.localStorage.setItem(b,c)}):(c.prototype.getItem=function(){return b},c.prototype.setItem=function(){}),d.prototype._write=function(b){var c=365,d=new Date;d.setTime(d.getTime()+24*c*60*60*1e3);var e="; expires="+d.toGMTString();a.document.cookie=this.name+"="+b+e+"; path=/"},d.prototype._read=function(){var a,b,c=this.name+"=",d=document.cookie.split(";");for(a=0;a<d.length;a++){for(b=d[a];" "===b.charAt(0);)b=b.substring(1,b.length);if(0===b.indexOf(c))return b.substring(c.length,b.length)}return null},d.prototype.getItem=function(a){var b=JSON.parse(this._read()||"{}");return b[a]},d.prototype.setItem=function(a,b){var c=JSON.parse(this._read()||"{}");c[a]=b,this._write(JSON.stringify(c))},e.prototype.getItem=function(c){var d=c.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),e=new RegExp("^"+d+"=(.*)$"),f=a.location.hash.slice(1).split(/[,#]/).map(function(a){var b=e.exec(a);return b?b[1]:null}).filter(function(a){return null!==a});return 0===f.length?b:f[0]},e.prototype.setItem=function(){};var f=new d("dashkiosk"),g=new c,h=new e;return{getItem:function(a){return h.getItem(a)||g.getItem(a)||f.getItem(a)},setItem:function(a,b){g.setItem(a,b),f.setItem(a,b)}}}(window)),define("osd",function(a,b){"use strict";return{hide:function(){b(".osd").removeClass("show")},show:function(c){b(".osd.technical").html("<p>clientWidth/Height: "+(a.document.documentElement.clientWidth||"???")+"×"+(a.document.documentElement.clientHeight||"???")+"</p><p><p>innerWidth/Height: "+(a.innerWidth||"???")+"×"+(a.innerHeight||"???")+"</p><p><p>screenWidth/Height: "+(a.screen.width||"???")+"×"+(a.screen.height||"???")+"</p>"),b(".osd.text").text(c),b(".osd").addClass("show")}}}(window,Zepto)),define("socketio",function(a,b,c){"use strict";function d(){var d=b.connect(a.location.origin+"/displays",{"reconnection limit":6e4,"max reconnection attempts":1/0});d.on("connect",function(){console.info("[Dashkiosk] connected to socket.io server");var a=g.getItem("register")||null;d.emit("register",{blob:a},function(a){console.info("[Dashkiosk] registered to server"),g.setItem("register",a)})}),d.on("connecting",function(){console.info("[Dashkiosk] connect in progress to socket.io server")}),d.on("connect_failed",function(){console.warn("[Dashkiosk] unable to connect to socket.io server"),a.location.reload()}),d.on("error",function(b){console.warn("[Dashkiosk] uncaught error with socket.io server: "+b),a.location.reload()}),d.on("reconnecting",function(a,b){console.info("[Dashkiosk] reconnect in progress to socket.io server (next: "+a+" attempts:"+b+")")}),d.on("reconnect_failed",function(){console.warn("[Dashkiosk] unable to reconnect to socket.io server"),a.location.reload()}),d.on("disconnect",function(){console.warn("[Dashkiosk] connection to socket.io lost"),e.loading()}),d.on("dashboard",function(a){console.info("[Dashkiosk] should display dashboard "+a.url),e.dashboard(a)}),d.on("reload",function(){console.info("[Dashkiosk] reload requested"),a.location.reload()}),d.on("osd",function(a){a===c||null===a?(console.info("[Dashkiosk] hide OSD"),f.hide()):(console.info("[Dashkiosk] display OSD"),f.show(a))}),d.on("viewport",function(a){console.info("[Dashkiosk] viewport change to "+(a||"default")+" requested"),new h(a).update()})}var e=require("screen"),f=require("osd"),g=require("localstorage"),h=require("viewport");return{connect:d}}(window,io)),function(a,b){"use strict";var c=require("socketio"),d=require("errors"),e=require("supervisor"),f=require("console");a.console=f,d.enable(),b(a).on("load",function(){e.ready(),f.log("[Dashkiosk] dashkiosk ready, connect to socket.io server"),c.connect()})}(window,Zepto);